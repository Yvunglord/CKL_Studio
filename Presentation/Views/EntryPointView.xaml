<UserControl x:Class="CKL_Studio.Presentation.Views.EntryPointView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:CKL_Studio.Presentation.Views"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:vm="clr-namespace:CKL_Studio.Presentation.ViewModels"
             xmlns:services="clr-namespace:CKL_Studio.Infrastructure.Services"
             d:DataContext="{d:DesignInstance Type=vm:EntryPointViewModel}"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">

    <Grid Background="#1e1e1e">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Label Style="{StaticResource Header}"
           Content="CKL Studio"
           Margin="60, 40, 0, 60"
           HorizontalAlignment="Left"
           VerticalAlignment="Top"/>

        <Label Style="{StaticResource h1}"
           Content="Открыть последние:"
           Margin="60, 0, 0, 0"/>

        <StackPanel Grid.Row="1"
                Grid.Column="1"
                Orientation="Vertical"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Margin="0,43,10,0">

            <Button Style="{StaticResource btTemplate}"
                Content="Создать"
                Command="{Binding NavigateToCKLCreationCommand}"
                />

            <Button Style="{StaticResource btTemplate}"
                Content="Открыть"
                Command="{Binding NavigateToCKLViewCommand}"
                />
            <Button Style="{StaticResource btTemplate}"
                Content="Открыть локальную папку"
                Command=""
                />
        </StackPanel>

        <Grid Grid.Row="1"
          Grid.Column="0"
          Margin="60,0,73,0">

            <Grid.RowDefinitions>

                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>

            </Grid.RowDefinitions>

            <ComboBox Style="{StaticResource CustomComboBoxStyle}"
                  Width="350"
                  Margin="10,10,0,0"
                  HorizontalAlignment="Left"
                  Grid.Row="0"                    
                  ItemsSource="{Binding SearchHistory}"
                  Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                  IsEditable="True"
                  IsTextSearchEnabled="True"
                  ItemContainerStyle="{StaticResource ComboBoxItemStyle}">
                 <ComboBox.InputBindings>
                     <KeyBinding Key="Enter" Command="{Binding SaveCommand}"/>
                 </ComboBox.InputBindings>
            </ComboBox>

            <ListBox Grid.Row="1"
                 MinHeight="350"
                 Margin="10,10,0,10"
                 HorizontalAlignment="Stretch"
                 VerticalAlignment="Stretch"
                 Background="#FF2C2C2C"
                 BorderThickness="0" 
                 ItemsSource="{Binding FilteredFiles}"
                 >

                <ListBox.InputBindings>
                    <KeyBinding Key="Enter" Command="{Binding OpenFileCommand}"/>
                </ListBox.InputBindings>

                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="MouseDoubleClick">
                        <i:InvokeCommandAction Command="{Binding OpenFileCommand}"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>

                <ListBox.ItemsPanel>

                    <ItemsPanelTemplate>

                        <VirtualizingStackPanel IsItemsHost="True" />

                    </ItemsPanelTemplate>

                </ListBox.ItemsPanel>
                
                <ListBox.ItemTemplate>

                    <DataTemplate>

                        <Border Background="#373737"
                 HorizontalAlignment="Stretch">
                            <Grid Height="50"
                   HorizontalAlignment="Stretch">

                                <Grid.ColumnDefinitions>

                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>

                                </Grid.ColumnDefinitions>

                                <Grid.RowDefinitions>

                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>

                                </Grid.RowDefinitions>

                                <TextBlock Text="{Binding Name}"
                            FontSize="14" 
                            Foreground="White"
                            FontWeight="Medium"
                            Margin="5,0,0,0"
                            VerticalAlignment="Top"/>

                                <TextBlock Text="{Binding Path}"
                            FontSize="12"
                            Foreground="White" 
                            FontWeight="Regular"
                            Margin="5,5,0,0" 
                            VerticalAlignment="Top"
                            Grid.Row="1"/>

                                <TextBlock Text="{Binding LastAccess}"
                            FontSize="12"
                            Foreground="White"
                            FontWeight="Regular"
                            Margin="5,0,5,0"
                            VerticalAlignment="Center" 
                            HorizontalAlignment="Right"
                            Grid.Column="1"
                            Grid.RowSpan="2"/>

                            </Grid>

                        </Border>

                    </DataTemplate>

                </ListBox.ItemTemplate>
                
            </ListBox>

        </Grid>

    </Grid>

</UserControl>
